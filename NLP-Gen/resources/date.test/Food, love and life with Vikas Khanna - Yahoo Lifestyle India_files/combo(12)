
/* blistmixedinplacerefresh.js 1571044 */ YUI.add("media-blistmixedinplacerefresh",function(d){function c(e){c.superclass.constructor.apply(this,arguments)}c.NAME="BListMixedInplaceRefresh";c.ATTRS={};d.extend(c,d.Base,{initializer:function(f){if(!f){d.log("No config passed in","warn",this.name);return}this.set("spaceid",(f.spaceid?f.spaceid:""));this.config=f;this.mod_id=f.mod_id;this.page_storage=new Array();this.list_start=parseInt(this.config.list_start,10);this.list_start=(this.list_start>1)?this.list_start:1;this.list_count=parseInt(this.config.list_count,10);this.ultpos_start=1;var g=parseInt(this.config.total,10);var e=parseInt(this.config.total_override,10);this.total=(e)?Math.min(this.list_start+e,g):g;this.xhr_start=this.list_start;this.use_advanced_filters=this.config.use_advanced_filters;this.advanced_filters=this.config.advanced_filters;this.entity_title=this.config.entity_title;this.categories=this.config.categories;this.site=this.config.site;this.lang=this.config.lang;this.region=this.config.region;if(f.show_more_link=="3"){this.DIV_CONTAINER_CLASS=".inplace-refresh";this.SHOW_MORE_CLASS=".inplace-refresh .refresh-link a.icon-twitter-rt-hover";d.mix(this,b,true,null,0)}else{if(f.show_more_link=="2"){this.DIV_CONTAINER_CLASS=".inline-show-more";this.SHOW_MORE_CLASS=".inline-show-more a.more-link";d.mix(this,a,true,null,0)}}this.anim=new d.Anim({from:{opacity:0},to:{opacity:1}});this.container=this.DIV_CONTAINER_CLASS?d.one("#"+this.mod_id+" "+this.DIV_CONTAINER_CLASS):null;if(!this.container){return}this.contentList=this.container.ancestor(".ft").previous(".bd").one("ul.yom-list");this.modeInit();this.attachEventListener()},attachEventListener:function(){if(this.SHOW_MORE_CLASS){d.delegate("click",this.clickHandler,"#"+this.mod_id,this.SHOW_MORE_CLASS,this)}},removeProgressIndicator:function(){if(this.container){this.container.removeClass("progress")}},addContentToList:function(f){if(!f){return}var e=d.Node.create(f);var g=null;if(!e.one("div#pd-module-1")){g=e;e=d.Node.create("<div>");e.appendChild(g)}else{e=e.one("#pd-module-1").removeAttribute("id")}e.addClass("page");e.addClass("_page_"+this.getCurrentPage());e.setStyle("opacity",0);if(e.one("li")==null){this.dealWithNoMoreContent()}if(this.contentList.one("li.last")){this.contentList.one("li.last").removeClass("last")}this.contentList.appendChild(e);this.displayContent(e);var h=YMedia.rapid;if(h&&h.refreshModule&&h.isModuleTracked(this.mod_id)){h.refreshModule(this.mod_id)}},getCurrentPage:function(){return Math.ceil(this.xhr_start/this.list_count)},displayContent:function(e){this.anim.set("node",e);this.anim.run();if((this.xhr_start+this.list_count)>this.total){this.dealWithNoMoreContent()}},clickHandler:function(e){e.preventDefault();this.fetchContent(true)},fetchContent:function(f){if(this.container.hasClass("progress")){return}if(this.fetchContentPreHook){this.fetchContentPreHook()}this.container.addClass("progress");var j=this.config.xhr_base;this.xhr_start+=this.list_count;this.ultpos_start+=this.list_count;this.xhr_start=(this.xhr_start>this.total)?this.list_start:this.xhr_start;j+="&list_start="+this.xhr_start+"&ultpos_start="+this.ultpos_start;if(this.page_storage[this.getCurrentPage()]){this.displayContent(this.page_storage[this.getCurrentPage()],true);this.removeProgressIndicator();if(this.fetchContentCallback){this.fetchContentCallback()}return}var h=Math.min(this.total-(this.xhr_start-1),this.list_count);j+="&list_count="+h;j+="&use_advanced_filters="+this.use_advanced_filters+"&advanced_filters="+this.advanced_filters+"&entity_title="+this.entity_title;var g="";if(!f){g="P#"}j+=this.get("spaceid")?"&spaceid="+g+encodeURIComponent(this.get("spaceid")):"";j+=this.categories?"&categories="+this.categories:"";j+=this.site?"&site="+this.site:"";j+=this.lang?"&lang="+this.lang:"";j+=this.region?"&region="+this.region:"";var i={complete:function(m,l,k){this.removeProgressIndicator();if(this.fetchContentCallback){this.fetchContentCallback()}},success:function(m,l,k){this.addContentToList(l.responseText)}};var e={on:{complete:i.complete,success:i.success},context:this};d.io(j,e)}});var b={modeInit:function(){this.rotateTimer=null;this.contentList.addClass("fade fadeIn");this.autoRotateContent()},dealWithNoMoreContent:function(){},autoRotateContent:function(){var e=this;if(this.rotateTimer){this.rotateTimer.cancel()}this.rotateTimer=d.later(parseInt(this.config.auto_rotate_duration,10)*1000,this,function(){var f=d.one("#"+this.mod_id).ancestor(".yui3-tab-panel");var g=(f&&f.getStyle("display")!="none")?true:false;if(d.DOM.inViewportRegion(d.Node.getDOMNode(this.contentList),false)&&g){this.fetchContent(false)}else{this.autoRotateContent()}})},updatePagingNumberInfo:function(){var e=parseInt(d.one("#"+this.mod_id+" .paging_number_info").one("span").get("text"),10)%parseInt(d.one("#"+this.mod_id+" .paging_number_info").all("span").item(1).get("text"),10)+1;d.one("#"+this.mod_id+" .paging_number_info").one("span").set("text",e)},fetchContentPreHook:function(){if(this.rotateTimer){this.rotateTimer.cancel()}},fetchContentCallback:function(){this.autoRotateContent()},addContentToList:function(h){if(!h){return}var e=(this.getCurrentPage()-1);var f=this.getCurrentPage();var g=d.Node.create(h);if(f==2){this.storePage(this.contentList.all("li").toFrag(),1)}this.contentList.removeClass("_page_"+e);this.contentList.addClass("_page_"+f);this.storePage(g);this.displayContent(g);var i=YMedia.rapid;if(i&&i.refreshModule&&i.isModuleTracked(this.mod_id)){i.refreshModule(this.mod_id)}},displayContent:function(f,e){if(e){f=f.cloneNode(true)}this.contentList.removeClass("fadeIn");this.contentList.insert(f,"replace");d.later(50,this.contentList,"addClass","fadeIn");this.updatePagingNumberInfo()},storePage:function(e,f){f=(f>0)?f:this.getCurrentPage();if(this.page_storage[f]){return}this.page_storage[f]=e.cloneNode(true)}};var a={modeInit:function(){},dealWithNoMoreContent:function(){this.disableMoreButton()},disableMoreButton:function(){this.container.remove(true)}};d.namespace("Media").BListMixedInplaceRefresh=c},"@VERSION@",{requires:["base","node","event","io","anim","event-delegate"]});