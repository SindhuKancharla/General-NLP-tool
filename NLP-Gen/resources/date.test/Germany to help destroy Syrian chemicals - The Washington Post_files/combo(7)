var WPS=window.WPS||{};WPS.Util={addCommas:function(B){B+="";x=B.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var A=/(\d+)(\d{3})/;while(A.test(x1)){x1=x1.replace(A,"$1"+","+"$2");}return x1+x2;},parseDateTime:function(F,C){var H=["JAN","FEB","MAR","APR","MAY","Jun","JUL","AUG","SEP","OCT","NOV","DEC"];var E=new Date;var B=new Date(F),D=Math.round((E-B)/(1000*60*60*24));if(E.getDate()===B.getDate()&&E.getMonth()===B.getMonth()&&E.getFullYear()===B.getFullYear()){var G=(B.getHours()<1?"12":B.getHours()>12?B.getHours()-12:B.getHours())+":"+(B.getMinutes()===0?"00":B.getMinutes()<10?"0"+B.getMinutes():B.getMinutes())+(B.getHours()>11?" PM":" AM")+" ET";if(!C){return G;}else{$(C).text(G);$(C).css("color","#ff0000");}}else{var A=H[B.getMonth()]+" "+B.getDate()+(B.getFullYear()===E.getFullYear()?"":", "+B.getFullYear());if(!C){return A;}else{$(C).attr("date",B.getTime());$(C).text(A);}}}};WPS.dropDown={init:function(A){this.$node=$(A).css("border-bottom","#FFF 1px solid");this.term=this.$node.val();this.$suggest=$('<input type="text" class="suggest" />').insertAfter(this.$node);this.$node.attr("autocomplete","off");this.$shell=$("#shell").length>0?$("#shell"):$("#page");this.resultList=this.Tmplt.resultList().appendTo($("body")).hide().css({right:this.$shell.offset().left-6,left:"auto",top:this.$node.offset().top+this.$node.height()+10}).find("ul");this.bind();},bind:function(){var C=this.fetchSuggestions,A=function(F){var E=$(this).val();if(WPS.dropDown.disabled===true){return ;}if(E.length<1){WPS.dropDown.hide();WPS.dropDown.$suggest.val("");return ;}if((F.which===40||F.which===9)&&WPS.dropDown.resultList.children().length>0){F.preventDefault();WPS.dropDown.resultList.children().eq(0).find("h3 a").eq(0).focus();return ;}if(F.which===8){WPS.dropDown.$suggest.val("");if(E.indexOf(" ")>-1){$(this).val(E.replace(E.split(" ")[E.split(" ").length-1],""));}}if(F.which===39&&WPS.dropDown.$suggest.val().length>0){WPS.dropDown.$node.val(WPS.dropDown.$suggest.val());WPS.dropDown.$suggest.val("");WPS.dropDown.fetchSuggestions(true);return ;}WPS.dropDown.fetchSuggestions();},D=function(E){if(E.which===13){B(E);}else{if((E.which===40||E.which===9)&&$(this).closest("li").next().length>0){E.preventDefault();$(this).closest("li").next().find("a.headline").eq(0).focus();}else{if(E.which===38){if($(this).closest("li").prev().length>0){$(this).closest("li").prev().find("a.headline").eq(0).focus();}else{WPS.dropDown.$node.focus();}}}}},B=function(F){try{s.sendDataToOmniture("Search Submit","event24",{eVar26:"search_auto_complete",eVar38:WPS.dropDown.$node.val(),eVar1:s.pageName});}catch(E){}};$(document).click(function(F){var E=$(F.target);if(E.closest(WPS.dropDown.resultList).length===0&&E.closest(WPS.dropDown.$node).length===0){WPS.dropDown.hide();}});if($("#search-core").length>0){if($("#search-core").val()!=="NEWS"){this.disabled===true;}$("#search-core").change(function(){if($("#search-core").val()!=="NEWS"){WPS.dropDown.disabled=true;WPS.dropDown.hide();WPS.dropDown.$suggest.val("");}else{WPS.dropDown.disabled=false;}});}this.$node.on("keyup",A);this.resultList.delegate("a","keyup",D).delegate("a","click",B);$(".search-dropdown").hide(500);},fetchSuggestions:function(B){this.term=this.$node.val();if(this.term.length-1===this.$suggest.val().length){var B=true;}B=!!B?true:false;var A=function(C){var D=0;if(!!B){for(i=0;i<C.facet_counts.facet_fields.suggest.length;i++){if(typeof C.facet_counts.facet_fields.suggest[i]==="string"&&C.facet_counts.facet_fields.suggest[i].indexOf(" ")>-1&&WPS.dropDown.term.length<C.facet_counts.facet_fields.suggest[i].length){D=i;break;}}}WPS.dropDown.showSuggestion(C.facet_counts.facet_fields.suggest[D]);};$.ajax({url:"http://www.washingtonpost.com/ssearch/spellsuggestcore/select/?json.wrf=?",dataType:"jsonp",data:{q:"suggest:"+$.trim(this.term.toLowerCase())+"*",start:"0",rows:"0",facet:"true","facet.method":"enum","facet.field":"suggest","facet.limit":"10","facet.prefix":$.trim(this.term.toLowerCase()),omitHeader:"true",wt:"json"},success:A});},fetchResults:function(B){var B=!!B?B:0,A=function(C){console.log(C);if(!!C.results&&!!C.results.documents&&!!C.results.documents.length){WPS.dropDown.resultList.children().remove();WPS.dropDown.showResults(C.results.documents,C.results.total);}else{}};$.ajax({url:"http://www.washingtonpost.com/newssearch/search.jsonp",dataType:"jsonp",data:{query:this.suggest,offset:B+10,startat:B},success:A});},showSuggestion:function(B){if(B!==this.$suggest.val()){this.suggest=B;this.fetchResults();}try{var B=B.split(this.term.toLowerCase())[1];}catch(A){return ;}if(B===undefined||B==="undefined"){return ;}this.$suggest.val(this.term+B);},showResults:function(E,H){var C=this.resultList,A=C.parent(),D=this.Tmplt.result,I=$(window).height()-this.$node.offset().top-80,B=90,G=this.Tmplt.seeMore,F=[];$.each(E,function(K,J){if(K>(I-30)/B){return false;}F.push(D(J,K).appendTo(C));C.find("img").error(function(){$(this).parent().remove();});});F.push(G(this.$suggest.val(),H).appendTo(C));if(!A.hasClass("open")){A.hide().height(I?I:C.height()).slideDown(500);}else{A.animate({height:I?I:C.height()});}this.$node.parent().css("border-bottom","#FFF 1px solid");A.addClass("open");},hide:function(){this.resultList.parent().slideUp(500).removeClass("open");this.$node.parent().css("border-bottom","1px solid #AFAFAF");},Tmplt:{resultList:function(){return $('<div class="b1s" id="search-dropdown"><div class="arrow" /><ul class="no-bullet padLR15" id="articles" /></div>');},result:function(B,A){if(B.headline.length>55){if(B.headline.slice(54,55)===" "||B.headline.slice(54,55)===","){B.headline=B.headline.slice(0,54);}else{B.headline=B.headline.slice(0,55);}}var C=$('<li class="clear marBT15">'+'<p class="ddDT">'+B.displaydatetime+"</p>"+(!!B.smallthumburl?'<div class="right marL10 marT2 search-image-conceal"><img src="'+B.smallthumburl.replace("145x100","296w")+'" width="80"></div>':"")+'<h3 class="fs14"><a class="headline" href="'+B.contenturl+((B.contenturl.indexOf("?")>-1)?"&":"?")+'tid=auto_complete">'+B.headline+"</a></h3>          </li>");WPS.Util.parseDateTime(B.displaydatetime,C.find("p.ddDT"));return C;},seeMore:function(B,A){return $('<li class="clear marBT15 more"><h3><a class="headline" href="http://washingtonpost.com/newssearch/search.html?query='+B+'&offset=10&startat=10">See all '+WPS.Util.addCommas(A)+' results for <strong>"'+B+'"</strong></a></h3></li>');},sResult:function(B,A){return $('						<li>							<a href="'+B.contenturl+'">								'+(!!B.smallthumburl?'<img src="'+B.smallthumburl+'" />':"")+"								<h2>"+(B.headline.length>77?B.headline.slice(0,77)+"ï¿½":B.headline)+"</h2>								<p>"+B.blurb+"</p>							</a>						</li>					");},suggestList:function(){return $('<ul class="bt1s fs16 no-bullet padLR15 strong" id="suggestions">');},suggest:function(A){return $('<li class="marBT15"><i class="icon-search"></i> <a href="http://www.washingtonpost.com/newssearch?st='+encodeRUIComponent(A)+'">barack obama</a></li>');}}};$(function(){WPS.dropDown.init($("form[name=headersearch] > input[type=text]"));});