(function(){TWP.Util=TWP.Util||{};TWP.Util.User=function(){var D=false;var O=false;var J=null;var H="";var E="";var K=null;var I=false;var F="washington-post";var G=["wapo_display"];var L=["wapo_login_id"];var C=["at"];function P(S,R){var T=-1,Q=-1;T=(S.indexOf(R)+R.length+1);Q=(K.indexOf(";",T))==-1?K.length:K.indexOf(";",T);return S.substring(T,Q).split("|")[0];}function N(){var T,Q,W,V=document.cookie.split(";");for(T=0;T<V.length;T++){var Q=V[T].substr(0,V[T].indexOf("="));var W=V[T].substr(V[T].indexOf("=")+1);var Q=Q.replace(/^\s+|\s+$/g,"");if(Q=="at"){var S=unescape(W);var R=S.split("=")[3];var U=false;if(R){R=R.split("&")[0];if(R){var U=A(R);}else{return U;}}else{return U;}return(R.length>0&&typeof R=="string"&&U)?R:false;}}}function A(R){var Q=R.indexOf("@");var S=R.lastIndexOf(".");if(Q<1||S<Q+2||S+2>=R.length){return false;}else{return true;}}function M(){var R=document.location.href;if(R.indexOf("localhost")>-1){var T=$.cookie("TWPNIUCID");if(typeof T=="undefined"||T==null){var S=new Date();var Q="TWPNI"+S.getTime()+"."+Math.round(Math.random()*10000);S.setTime(S.getTime()+31104000000);$.cookie("TWPNIUCID",Q,{domain:TWP.Data.cookie_domain,expires:S,path:"/"});}}if(R.indexOf("beta")>-1){var T=$.cookie("x-split-override");if(T==null||typeof T=="undefined"){var S=new Date();S.setTime(S.getTime()+(1000*60*60*24*45));$.cookie("x-split-override","B",{domain:TWP.Data.cookie_domain,path:"/"});$.cookie("X-WP-Split","B",{domain:TWP.Data.cookie_domain,path:"/"});}}}function B(){var R=$.cookie("x-split-override");if(typeof R!="undefined"&&R!=null){$.cookie("x-split-override",null,{domain:TWP.Data.cookie_domain,path:"/"});$.cookie("x-split-override",R,{domain:TWP.Data.cookie_domain,path:"/"});}var Q=$.cookie("X-WP-Split");if(typeof Q!="undefined"&&Q!=null){$.cookie("X-WP-Split",null,{domain:TWP.Data.cookie_domain,path:"/"});$.cookie("X-WP-Split",Q,{domain:TWP.Data.cookie_domain,path:"/"});}}return{init:function(){var R="";for(var Q=0;Q<L.length;Q++){if(document.cookie.indexOf(L[Q])!=-1){O=true;break;}}for(var Q=0;Q<G.length;Q++){if(document.cookie.indexOf(G[Q])!=-1){K=document.cookie;F=G[Q];break;}}if(O){switch(F){case"fbuname":R=P(K,F,8);break;default:R=P(K,F,9);break;}J=(R.indexOf("@")!==-1)?R.substring(0,R.indexOf("@")):R;J=J.replace(/"/gi,"");H=R;E=N();}M();B();},getUserCookie:function(){return(K.length>0&&typeof K=="string")?K:null;},getUserType:function(){return(F.length>0&&typeof F=="string")?F:null;},getUserId:function(){return H;},getUserName:function(){return(typeof J=="string")?J:"";},getUserEmail:function(){return(E.length<0||E==false)?null:E;},getAuthentication:function(){return O;}};}();TWP.Util.User.init();})();(function(){window.TWP=window.TWP||{};TWP.Identity=TWP.Identity||{};TWP.Identity.paywall=TWP.Identity.paywall||{};TWP.Identity.paywall.requireTracking=true;TWP.server=TWP.server||window.location.href.match(/^.*?:\/\/.*?\//)[0];var isSSL=(window.location.protocol.indexOf("https"))<0?false:true;var currDomain=(TWP.Data&&(TWP.Data.environment=="prod")||TWP.Data.environment=="stage")?".washingtonpost.com":".digitalink.com";var d=new Date();var expireTime=d.setHours(d.getHours()+24);var userCookie="wapo_login_id";var wpatcCookie="WPATC";var actmgmtCookie="wapo_actmgmt";var gmeCookie="wapo_gme";var user=$.cookie(userCookie);var wpatc=$.cookie(wpatcCookie);var wapo_actmgmt=$.cookie(actmgmtCookie);var wapo_gme=$.cookie(gmeCookie);var overlays=new Array();overlays[0]={};overlays[1]={overlay:'<div id="wp_Alert" class="simple-overlay" style="overflow: hidden;"><iframe src height="200px" width="390px" scrolling="no" frameborder="0"></iframe></div>',overlayConfig:{top:260,mask:{color:"#000000",loadSpeed:200,opacity:0},bottom:"0px",left:"0px",closeOnClick:true,closeOnEsc:true,load:true,onClose:function(){if(s&&typeof s.sendDataToOmniture=="function"){var closeVars={"eVar1":s.eVar1,"eVar2":s.eVar2,"eVar6":s.eVar6,"eVar7":"","eVar17":s.eVar17,"eVar62":s.eVar62,"eVar64":s.eVar64,"eVar65":s.eVar65,"eVar66":s.eVar66};try{s.sendDataToOmniture("close alert","event67",closeVars);}catch(e){}}}},overflowCss:"",closeSelector:"#wp_Alert a.close"};overlays[2]={overlay:'<div id="wp_Signin" class="simple-overlay" style="overflow: hidden;"><a class="close"></a><iframe src height="100%" width="100%" scrolling="no" frameborder="0"></iframe></div>',overlayConfig:{top:260,mask:{color:"#000000",loadSpeed:200,opacity:0.7},top:"center",left:"center",closeOnClick:false,closeOnEsc:false,load:true,onClose:function(){if($(arguments[0].target).is("a.close")){window.location.href="/";}$("body").css("overflow-y","");$(document).unbind("touchmove mousewheel mousemove scroll",_scrollHandler);if(s&&typeof s.sendDataToOmniture=="function"){var closeVars={"eVar1":s.pageName,"eVar2":s.channel,"eVar5":s.prop3};try{s.sendDataToOmniture("close overlay","event69",closeVars);}catch(e){}}}},overflowCss:"hidden",closeSelector:"#wp_Signin a.close"};overlays[3]={overlay:'<div id="wp_Signin" class="simple-overlay" style="overflow: hidden;"><a class="close"></a><iframe src height="100%" width="100%" scrolling="no" frameborder="0"></iframe></div>',overlayConfig:{top:260,mask:{color:"#000000",loadSpeed:200,opacity:0.7},top:"center",left:"center",closeOnClick:false,closeOnEsc:false,load:true,onClose:function(){if($(arguments[0].target).is("a.close")){window.location.href="/";}$("body").css("overflow-y","");$(document).unbind("touchmove mousewheel mousemove scroll",_scrollHandler);if(s&&typeof s.sendDataToOmniture=="function"){var closeVars={"eVar1":s.pageName,"eVar2":s.channel,"eVar5":s.prop3};try{s.sendDataToOmniture("close overlay","event63",closeVars);}catch(e){}}}},overflowCss:"hidden",closeSelector:"#wp_Signin a.close"};overlays[4]={overlay:'<div id="wp_Signin" class="simple-overlay" style="overflow: hidden;"><a class="close"></a><iframe src height="100%" width="100%" scrolling="no" frameborder="0"></iframe></div>',overlayConfig:{top:260,mask:{color:"#000000",loadSpeed:200,opacity:0.7},top:"center",left:"center",closeOnClick:true,closeOnEsc:true,load:true,onClose:function(){$("body").css("overflow-y","");$(document).unbind("touchmove mousewheel mousemove scroll",_scrollHandler);if(s&&typeof s.sendDataToOmniture=="function"){var closeVars={"eVar1":s.pageName,"eVar2":s.channel,"eVar5":s.prop3,"eVar63":"one-time overlay"};try{s.sendDataToOmniture("close overlay","event69",closeVars);}catch(e){}}}},overflowCss:"hidden",closeSelector:"#wp_Signin a.close"};TWP.Identity.omniture={sub:{"-1":"N/A","0":"Unsubscribed","1":"Subscribed"},mtr:{"-1":"Unmetered","1":"Metered","20":"Unmetered: content_type","21":"Unmetered: referer","22":"Unmetered: domain"},tracking:{"wp_evar64":"not available","wp_evar65":"not available","wp_evar66":"not available"}};TWP.Identity.setAuthenticationLink=function(data){if(typeof data=="object"){$.extend(TWP.Identity.paywall.pwresp,data.pwresp);}var wrapperElm=$("#utility-wrapper");if(wrapperElm.length<=0){return ;}var userName="";var provider="";var currentURL=window.location.href.split("?")[0];if(TWP.server.match(/digitalink\.com|washingtonpost\.com|wpprivate\.com/ig)==null){return ;}TWP.Identity.isSignedIn=TWP.Util.User.getAuthentication();if(TWP.Identity.isSignedIn){userName=TWP.Util.User.getUserName();provider=(typeof TWP.signedInProvider=="function")?TWP.signedInProvider():"Washington Post";provider=(typeof provider!="undefined")?provider.toLowerCase():"";}var freeAccessLink=(TWP.Identity.paywall.pwresp.fr===1)?'<li class="no-right">'+'<a href="'+TWP.signin.free_access+'">GET FREE ACCESS</a>'+"</li>":"";var signinLinks={"pw":{"anon":'<li id="global-signin"style="min-width:32px;">'+'<a href="'+TWP.signin.loginurl_page+currentURL+'">Sign In</a>'+"</li>"+'<li class="no-right"><a href="'+TWP.signin.profileurl+currentURL+'&refresh=true">My Account </a></li>'+freeAccessLink+'<ul class="subscribe-links left">'+'<li class="no-right subscribe"><a href="'+TWP.signin.subscribe+'?tid=nav_subscribe&promo=dghpnav">SUBSCRIBE: </a></li>'+'<li ><a href="'+TWP.signin.print_offer+'&tid=nav_signup_home&promo=dghpnav">Home Delivery</a></li>'+'<li><a href="'+TWP.signin.digital_offer+'&tid=nav_signup_digital&promo=dghpsubtn">Digital</a></li>'+'<li class="no-right"><a href="'+TWP.signin.subscribe+'/gift-subscription.html?landing=1&tid=nav_gift">Gift Subscriptions</a></li>'+"</ul>","0":"<li>"+((provider.indexOf("facebook")>=0)?'<a class="icon share facebook" ':"<a ")+' href="'+TWP.signin.profileurl+currentURL+'&refresh=true"> Hi, '+userName+"!</a>"+"</li>"+'<li><a href="'+TWP.signin.profileurl+currentURL+'&refresh=true">My Account </a></li>'+'<li class="no-right"><a href="'+TWP.signin.logouturl_page+'">Sign Out</a></li>'+freeAccessLink+'<ul class="subscribe-links left">'+'<li class="no-right subscribe"><a href="'+TWP.signin.subscribe+'?tid=nav_subscribe&promo=dghpnav">SUBSCRIBE: </a></li>'+'<li ><a href="'+TWP.signin.print_offer+'&tid=nav_signup_home&promo=dghpnav">Home Delivery</a></li>'+'<li><a href="'+TWP.signin.digital_offer+'&tid=nav_signup_digital&promo=dghpsubtn">Digital</a></li>'+'<li class="no-right"><a href="'+TWP.signin.subscribe+'/gift-subscription.html?landing=1&tid=nav_gift">Gifts</a></li>'+"</ul>","1":"<li>"+((provider.indexOf("facebook")>=0)?'<a class="icon share facebook" ':"<a ")+' href="'+TWP.signin.profileurl+currentURL+'&refresh=true">Hi, '+userName+"!</a>"+"</li>"+'<li><a href="'+TWP.signin.profileurl+currentURL+'&refresh=true">My Account </a></li>'+'<li class="no-right"><a href="'+TWP.signin.logouturl_page+'">Sign Out</a></li>'+'<ul class="subscribe-links left">'+'<li class="no-right"><a href="'+TWP.signin.subscribe+'/gift-subscription.html?landing=1&tid=nav_gift">Gift Subscriptions</a></li>'+"</ul>"},"np":{"anon":'<li id="global-signin" style="min-width:32px;">'+'<a href="'+TWP.signin.loginurl_page+currentURL+'">Sign In</a>'+"</li>"+'<li><a href="'+TWP.signin.profileurl+currentURL+'&refresh=true">My Account </a></li>'+'<li id="global-registration" class="no-right" style="margin-right:25px;">'+'<a href="'+TWP.signin.registrationurl_page+currentURL+'">Register</a>'+"</li>","signedin":'<li id="global-signin" style="min-width:32px;">'+((provider.indexOf("facebook")>=0)?'<a class="icon share facebook" ':"<span>Hello </span><a ")+' href="'+TWP.signin.profileurl+currentURL+'&refresh=true">'+userName+"</a>"+"</li>"+'<li><a href="'+TWP.signin.profileurl+currentURL+'&refresh=true">My Account </a></li>'+'<li  id="global-registration" class="no-right" style="margin-right:25px;"><a href="'+TWP.signin.logouturl_page+'">Sign Out</a></li>'}};
var linkString="";if(TWP.Identity.paywall.pwresp.sub<0){if(TWP.Identity.isSignedIn){linkString=signinLinks.np.signedin;}else{linkString=signinLinks.np.anon;}}else{if(TWP.Identity.isSignedIn){linkString=signinLinks.pw[TWP.Identity.paywall.pwresp.sub];}else{linkString=signinLinks.pw.anon;}}wrapperElm.find("ul#utility-links.inline-list.left").remove();wrapperElm.prepend('<ul id="utility-links" class="inline-list left">'+linkString+"</ul>");};TWP.Identity.setHandlers=function(){try{$(window.document).on("onTwpLoginComplete",function(event,data){(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log(event.type+"fired!");event.stopPropagation();TWP.Util.User.init();TWP.Identity.setAuthenticationLink(data);try{$("body").css("overflow-y","");$("#wp_Signin.simple-overlay").overlay().close();}catch(e){}});}catch(e){}try{$(window.document).on("onTwpMeterReady",function(event,data){if(TWP.Identity.paywall.pwresp.action===0&&TWP.Identity.paywall.pwresp.fr===1&&wapo_gme!=="1"){$.cookie(gmeCookie,"1",{domain:currDomain,expires:new Date(expireTime),path:"/"});_openOverlay(event,{pwresp:{action:4,url:TWP.signin.free_access_overlay}});}});}catch(e){}try{$(window.document).on("onTwpWarningFreeAccess",function(event,data){_openOverlay(event,data);});}catch(e){}try{$(window.document).on("onTwpMastheadComplete",function(event,data){event.stopPropagation();TWP.Identity.setAuthenticationLink();});}catch(e){}try{$(window.document).on("onTwpLoginInit",function(event,data){_openOverlay(event,data);});}catch(e){}};TWP.Identity.auth=function(){var origUrl=(window.originalWashingtonPostURl&&window.originalWashingtonPostURl.substring(window.originalWashingtonPostURl.indexOf(".com/")+4))||location.pathname;origUrl=origUrl+location.search;if(isSSL){return ;}$.ajax({type:"GET",url:TWP.signin.auth_api_url+(encodeURI(origUrl+((origUrl.indexOf("?")>=0)?"&":"?")+"rplapisplit=1&referrer="+document.referrer)),dataType:"jsonp",timeout:2000,cache:"false"}).always(function(data,status){(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log("RegWall action: "+data.pwresp.action+"\nRegWall - url: "+data.pwresp.url+"\n");(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log(data);window.console&&console.log&&console.log("PAYWALL CHECK STATUS: "+status);window.console&&console.log&&console.log("PWAPI URL: "+TWP.signin.auth_api_url+(encodeURI(origUrl+((origUrl.indexOf("?")>=0)?"&":"?")+"rplapisplit=1&referrer="+document.referrer)));if(status=="success"&&data&&data.pwresp){window.console&&console.log&&console.log("PAYWALL ACTION: "+data.pwresp.action);window.console&&console.log&&console.log("PAYWALL URL: "+data.pwresp.url);window.console&&console.log&&console.log("PAYWALL SUB: "+TWP.Identity.omniture.sub[data.pwresp.sub]);window.console&&console.log&&console.log("PAYWALL METERED: "+TWP.Identity.omniture.mtr[data.pwresp.mtr]);window.console&&console.log&&console.log("PAYWALL METER COUNT: "+data.pwresp.mtrct);window.console&&console.log&&console.log("PAYWALL MODE: "+data.pwresp.mtfn);$.extend(TWP.Identity.paywall,eval(data));TWP.Identity.setAuthenticationLink();TWP.Identity.omniture.tracking.wp_evar64=(data.pwresp.sub==1)?TWP.Identity.omniture.sub[data.pwresp.sub]:(data.pwresp.action>1)?"overlay":data.pwresp.mtrct;TWP.Identity.omniture.tracking.wp_evar65=data.pwresp.sub.toString();TWP.Identity.omniture.tracking.wp_evar66=data.pwresp.mtr;for(trackingVar in TWP.Identity.omniture.tracking){window[trackingVar]=TWP.Identity.omniture.tracking[trackingVar];}_openOverlay(null,data);$(window.document).trigger("onTwpMeterReady");}});};TWP.Identity.init=function(){if(!TWP.Identity.initComplete&&window.top==window.self){TWP.Identity.setHandlers();_signInInit();$(document).ready(function(){TWP.Identity.auth();TWP.Identity.initComplete=true;});}};var _scrollHandler=function(event){event.stopPropagation();return false;};var _signInInit=function(){try{if(!wapo_actmgmt||(user&&wpatc&&!wpatc.match(/\:K\=\d+/))){var url=TWP.signin.api_url+"?username="+user;$.ajax({type:"GET",url:url,dataType:"jsonp",timeout:2000,cache:"false",success:function(data){if(data.K){wpatc=wpatc.replace(/\:K\=\d+/,"");thisData=(typeof data=="object")?data:jQuery.parseJSON(data);$.cookie("WPATC",wpatc+":K="+thisData.K,{domain:currDomain,expires:new Date(expireTime),path:"/"});}}});}}catch(e){}};var _openOverlay=function(event,data){(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log(event.type+"fired!");try{event&&event.stopPropagation();}catch(e){}if(typeof overlays[data.pwresp.action].overlay!=="undefined"&&data.pwresp.action>0){(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log("Regwall: preparing to display overlay");(typeof TWP_Debug!="undefined")&&TWP_Debug.pagedebug&&window.console&&console.log&&console.log(TWP.Identity.paywall);var overlay=$(overlays[data.pwresp.action].overlay);var obj=$.extend({},TWP.Identity.paywall.pwresp,data.pwresp);var params="";$.each(obj,function(i,v){params=params+"&"+i+"="+v;});var url=data.pwresp.url+((data.pwresp.url.indexOf("?")>=0)?"&":"?")+encodeURI("page="+(s&&s.eVar1)+"&section="+(s&&s.eVar2)+"&prev="+(s&&s.eVar6)+"&geo="+(s&&s.eVar7)+"&ctype="+(s&&s.eVar17)+"&signedin="+(s&&s.eVar62)+"&mcount="+(data.pwresp.mtrct||(TWP.Identity.paywall.pwresp&&TWP.Identity.paywall.pwresp.mtrct))+"&sub="+(data.pwresp.sub||(TWP.Identity.paywall.pwresp&&TWP.Identity.paywall.pwresp.sub))+"&ismetered="+(data.pwresp.mtr||(TWP.Identity.paywall.pwresp&&TWP.Identity.paywall.pwresp.mtr))+params);$("body").css("overflow-y",overlays[data.pwresp.action].overflowCss);$("body").prepend(overlay);if(data.pwresp.action>1){$(document).on("touchmove mousewheel mousemove scroll",_scrollHandler);}overlay.overlay(overlays[data.pwresp.action].overlayConfig);overlay.find("iframe").attr("src",url);}};TWP.Identity.init();})();